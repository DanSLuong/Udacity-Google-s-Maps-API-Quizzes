<!-- This is the code for all the lessons and quizzes in Udacity and Google's Maps
API Course, Lesson 1-18 -->
<!DOCTYPE html>
<html>

<head>
    <title>Simple Map</title>
    <meta name="viewport" content="initial-scale=1.0">
    <meta charset="utf-8">
    <style>
        /* Always set the map height explicitly to define the size of the div
               * element that contains the map. */

        #map {
            bottom: 0px;
            height: 100%;
            left: 362px;
            position: absolute;
            right: 0px;
        }

        /* Optional: Makes the sample page fill the window. */

        html,
        body {
            height: 100%;
            margin: 0;
            padding: 0;
        }

        .options-box {
            background: #fff;
            border: 1px solid #999;
            border-radius: 3px;
            height: 100%;
            line-height: 35px;
            padding: 10px 10px 30px 10px;
            text-align: left;
            width: 340px;
        }

        #pano {
            width: 250px;
            height: 250px;
        }
    </style>
</head>

<body>
    <div class="container">
        <div class="options-box">
            <h1> Houston Homes Around Midtown! </h1>
            <div>
                <input id="show-listings" type="button" value="Show Listings">
                <input id="hide-listings" type="button" value="Hide Listings">
            </div>
        </div>
    </div>
    <!-- TODO 1: Create a place to put the map in the HTML-->
    <div id="map"></div>
    <script>
        // Map variable
        var map;
        // Blank Marker Array to store all the listings as markers
        var markers = [];

        // Function to initialize the map
        function initMap() {
            // Creates a styles array to use with the map we created
            var styles = [
                {
                    featureType: 'water',
                    stylers: [
                        { color: '#19a0d8' }
                    ]
                }, {
                    featureType: 'administrative',
                    elementType: 'labels.text.stroke',
                    stylers: [
                        { color: '#ffffff' },
                        { weight: 6 }
                    ]
                }, {
                    featureType: 'administrative',
                    elementType: 'labels.text.fill',
                    stylers: [
                        { color: '#e85113' }
                    ]
                }, {
                    featureType: 'road.highway',
                    elementType: 'geometry.stroke',
                    stylers: [
                        { color: '#efe9e4' },
                        { lightness: -40 }
                    ]
                }, {
                    featureType: 'transit.station',
                    stylers: [
                        { weight: 9 },
                        { hue: '#e85113' }
                    ]
                }, {
                    featureType: 'road.highway',
                    elementType: 'labels.icon',
                    stylers: [
                        { visibility: 'off' }
                    ]
                }, {
                    featureType: 'water',
                    elementType: 'labels.text.stroke',
                    stylers: [
                        { lightness: 100 }
                    ]
                }, {
                    featureType: 'water',
                    elementType: 'labels.text.fill',
                    stylers: [
                        { lightness: -100 }
                    ]
                }, {
                    featureType: 'poi',
                    elementType: 'geometry',
                    stylers: [
                        { visibility: 'on' },
                        { color: '#f0e4d3' }
                    ]
                }, {
                    featureType: 'road.highway',
                    elementType: 'geometry.fill',
                    stylers: [
                        { color: '#efe9e4' },
                        { lightness: -25 }
                    ]
                }
            ];

            // Constructor to create a new map JS object - only center and zoom are required
            map = new google.maps.Map(document.getElementById('map'), {
                center: { lat: 29.7604, lng: -95.3698 },
                zoom: 13,
                styles: styles,
                mapTypeControl: false
            });
            // Create real estate listings. Normally this would be put into a database
            var locations = [
                { title: 'Memorial Club Apartments', location: { lat: 29.770328, lng: -95.423998 } },
                { title: 'Elan Memorial Park Luxury Apartments', location: { lat: 29.770704, lng: -95.422771 } },
                { title: 'Nice Midtown Condo', location: { lat: 29.769756, lng: -95.421690 } },
                { title: 'Large Two Story House', location: { lat: 29.770530, lng: -95.420616 } },
                { title: 'Fancy Three Story Condo', location: { lat: 29.771865, lng: -95.421548 } },
                { title: 'Simple Apartment Complex', location: { lat: 29.772972, lng: -95.420053 } }
            ];

            var largeInfowindow = new google.maps.InfoWindow();

            // Style the markers a bit. this will be our listing marker icon.
            var defaultIcon = makeMarkerIcon('0091ff');

            // Create a "highlighted location" marker color for when the user mouses over the marker.
            var highlightedIcon = makeMarkerIcon('FFFF24');

            // Array that uses the location array to create an array of markers on initialize.
            for (var i = 0; i < locations.length; i++) {
                var position = locations[i].location;
                var title = locations[i].title;
                // Create a marker per location and store it into markers array.
                var marker = new google.maps.Marker({
                    position: position,
                    title: title,
                    icon: defaultIcon,
                    animation: google.maps.Animation.DROP,
                    id: i
                });
                // Push the marker onto the array of markers.
                markers.push(marker);
                // Creates an EVENT LISTENER to open infowindow when the marker is clicked!
                marker.addListener('click', function () {
                    populateInfoWindow(this, largeInfowindow);
                });

                // Mouseover and mouseout events to highlight and return the marker to normal
                marker.addListener('mouseover', function () {
                    this.setIcon(highlightedIcon);
                });
                marker.addListener('mouseout', function () {
                    this.setIcon(defaultIcon);
                });
            }

            document.getElementById('show-listings').addEventListener('click', showListings);
            document.getElementById('hide-listings').addEventListener('click', hideListings);
        }

        // Populate the infowindow when the marker is clicked based on markers' position
        function populateInfoWindow(marker, infowindow) {
            // Check to make sure the infowindow isn't already oepn for this marker.
            if (infowindow.marker != marker) {
                // Clear the infowindow content to give the streetview time to load.
                infowindow.setContent('');
                infowindow.marker = marker;
                // Make sure the marker property is cleared if the infowindow is closed.
                infowindow.addListener('closeclick', function () {
                    infowindow.marker = null;
                });

                var streetViewService = new google.maps.StreetViewService();
                // Look for a streetView image withing 50 meters
                var radius = 50;

                function getStreetView(data, status) {
                    if (status == google.maps.StreetViewStatus.OK) {
                        var nearStreetViewLocation = data.location.latLng;
                        var heading = google.maps.geometry.spherical.computeHeading(
                            nearStreetViewLocation, marker.position);
                        infowindow.setContent('<div>' + marker.title + '</div><div id="pano"></div>');
                        var panoramaOptions = {
                            position: nearStreetViewLocation,
                            pov: {
                                heading: heading,
                                pitch: 30
                            }
                        };
                        var panorama = new google.maps.StreetViewPanorama(
                            document.getElementById('pano'), panoramaOptions);
                    } else {
                        infowindow.setContent('<div>' + marker.title + '</div>' +
                            '<div>No Street View Found</div>');
                    }
                }
                // Use streetview service to get the closest streetview image within
                // 50 meters of the markers position
                streetViewService.getPanoramaByLocation(marker.position, radius, getStreetView);
                // Open the infowindow on the correct marker.
                infowindow.open(map, marker);
            }
        }

        function showListings() {
            // Captures the SW and NE corners of the view port
            var bounds = new google.maps.LatLngBounds();
            // Extend the boundaries of the map for each marker and display the marker
            for (var i = 0; i < markers.length; i++) {
                markers[i].setMap(map);
                // Extends the bounderies to fit each marker in
                bounds.extend(markers[i].position);
            }
            map.fitBounds(bounds);
        }

        function hideListings() {
            for (var i = 0; i < markers.length; i++) {
                markers[i].setMap(null);
            }
        }

        // of 0,0 and be anchored at 10, 34
        function makeMarkerIcon(markerColor) {
            var markerImage = new google.maps.MarkerImage(
                'http://chart.googleapis.com/chart?chst=d_map_spin&chld=1.15|0|' + markerColor +
                '|40|_|%E2%80%A2',
                new google.maps.Size(21, 34),
                new google.maps.Point(0, 0),
                new google.maps.Point(10, 34),
                new google.maps.Size(21, 34));
            return markerImage;
        }
    </script>
    <!-- Load the JS API ASYNCHRONOUSLY -->
    <script src="https://maps.googleapis.com/maps/api/js?libraries=geometry&key=AIzaSyCq1GE9uIunJEUzqnfxH8id_xknI7okebk&callback=initMap"
        async defer></script>
</body>

</html>